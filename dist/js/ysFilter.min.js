/**
 * ys-filter - For filtering and sorting products returned from Silk API.
 * @version v0.2.5
 * @link http://youngskilled.com
 * @author richard@youngskilled.com Young/Skilled
 * @license MIT
 */
!function(e,t){var s={init:function(){var l=this;l.set.filteredBy=s.dehashify.apply(l,[t.location.hash]),l.set.debug===!0&&console.log("var ",l.set.filteredBy),l.set.currentHash=t.location.hash,l.addClass("ysFilter-loading ysFilter-init"),""!==l.set.currentHash&&(l.addClass("ysFilter-filtered"),l.set.updateWHash!==!1&&e("."+l.set.updateWHash).each(function(){var t=e(this).attr("href");e(this).attr("href",t+l.set.currentHash)})),parseInt(l.set.filteredBy.page)>1&&l.find(".prev").closest(".paging").show(),e.ajax({url:l.set.url,type:"GET",cache:!0,dataType:"JSON",success:function(e){l.filter=e,l.set.debug===!0&&console.log("var $this.filter",l.filter),s.buildFilter.apply(l),s.enableEvents.apply(l),l.set.limit=e.limit,l.set.pages=Math.ceil(e.items.length/l.set.limit),l.set.currentPageLoaded=1,""!==l.set.currentHash?(s.gatherItems.apply(l),s.reSelect.apply(l)):(l.set.currentItems=l.filter.items.slice(0),l.set.debug===!0&&s.renderItems.apply(l))}})},buildFilter:function(){var t=this,l=t.find("."+t.set.groupClass),r="",a="",i={},n=t.filter.desc.param_types.length,o=t.set.splitSizes!==!1?"</"+t.set.splitSizes.match(/<([a-z]+)/)[1]+">":"";if(void 0!==t.filter.sort){var d=e("#sort"),c=void 0!==t.filter.sort.init?t.filter.sort.init:"";a=d.data("create"),i=t.set.filterOptions[p]||{};for(var f in t.filter.sort)"init"!==f&&(t.filter.sort[f].asc&&(r+=s.buildFilterTemplate.call(t,a,"sort-"+f+"-asc",'["'+f+'","asc"]',t.filter.sort[f].asc,i)),t.filter.sort[f].dsc&&(r+=s.buildFilterTemplate.call(t,a,"sort-"+f+"-dsc",'["'+f+'","dsc"]',t.filter.sort[f].dsc,i)));void 0!==i.wrapperGroup&&(r=i.wrapperGroup+r+"</"+i.wrapperGroup.match(/<([a-z]+)/)[1]+">"),"fakeSelect"===a&&(r=s.buildFilterTemplate.call(t,"start_"+a,"","",c,i)+r,r='<div class="filter-value fake-select"><span data-orig-text="'+c+'">'+c+'</span><ul class="ul-clean fake-select-list">'+r+"</ul></div>"),("select"===a||"multiSelect"===a)&&(r='<select class="filter-value"'+("multiSelect"===a?' multiple="multiple"':"")+'><option value="0">'+c+"</option>"+r+"</select>"),d.append(r)}for(var u=0;n>u;u++){var p=t.filter.desc.param_types[u],g=t.filter.desc.param_descs[p],h=l.filter("#"+p),v=(h.data("type"),""),m="",y=null,b=null,C=[];r="",a=h.data("create"),i=t.set.filterOptions[p]||{};for(var F in t.filter.desc[p])m=t.filter.desc[p][F].name,t.filter.desc[p][F].data&&(""!==t.filter.desc[p][F].data.color?m=[m,t.filter.desc[p][F].data.color]:""!==t.filter.desc[p][F].data.hex&&(m=[m,t.filter.desc[p][F].data.hex])),-1!==m.indexOf("###")?(y="tree",C=m.split("###"),m=C.pop(),b!==C.join("")&&(null!==b&&(r+=s.buildFilterTemplate.call(t,"group_"+a,"",v,b,i),v=""),b=C.join("")),v+=s.buildFilterTemplate.call(t,a,p+"-"+F,F,m,i)):t.set.splitSizes!==!1&&"size"===p?(y="size",sizeTables=F.split("_"),b!==sizeTables[0]&&(null!==b&&(r+=t.set.splitSizes+v+o,v=""),b=sizeTables[0]),v+=s.buildFilterTemplate.call(t,a,p+"-"+F,F,m,i)):r+=s.buildFilterTemplate.call(t,a,p+"-"+F,F,m,i);null!==b&&(r+="tree"===y?s.buildFilterTemplate.call(t,"group_"+a,"",v,b,i):t.set.splitSizes+v+o),void 0!==i.wrapperGroup&&(r=i.wrapperGroup+r+"</"+i.wrapperGroup.match(/<([a-z]+)/)[1]+">"),"fakeSelect"===a&&(v=s.buildFilterTemplate.call(t,"start_"+a,"",F,g,i),r='<div class="filter-value fake-select"><span data-orig-text="'+g+'">'+g+'</span><ul class="ul-clean fake-select-list">'+v+r+"</ul></div>"),("select"===a||"multiSelect"===a)&&(r='<select name="'+p+'" class="filter-value"'+("multiSelect"===a?' multiple="multiple"':"")+'><option value="0">'+g+"</option>"+r+"</select>"),h.append(r)}t.removeClass("ysFilter-loading ysFilter-filtered").addClass("ysFilter-loaded"),void 0!==t.set.afterFilterRendered&&t.set.afterFilterRendered()},buildFilterTemplate:function(e,t,s,l,r){var a=this,i={desc:l},n="",o="",d="",c="",f="",u="",p="",g=!1;for(var h in r)switch(h){case"classNames":n=r[h].join(" ");break;case"background":g=r[h];break;case"attrs":c=" "+r[h].replace("{desc}",l[0]);break;case"wrapper":o=r[h],d="</"+r[h].match(/<([a-z]+)/)[1]+">"}return"object"==typeof l&&(i.desc=l[0],g&&(f=l[1]&&"#"===l[1].substr(0,1)?"background-color: "+l[1]:"background-image: url('"+DYN+"attributes/"+l[1]+"')")),void 0!==a.set.eachFilterAttrs&&(i=a.set.eachFilterAttrs(i)),u=g?' style="'+f+'"':"",p=g?"":i.desc,"a"===e?o+'<a id="'+t+'" class="'+n+' filter-value" href="#"'+u+" data-value='"+s+"'"+c+">"+p+"</a>"+d:"select"===e||"multiSelect"===e?'<option id="'+t+'" value="'+s+'">'+i.desc+"</option>":"fakeSelect"===e?'<li class="'+n+'"'+c+'><a id="'+t+'" class="filter-value" href="#"'+u+" data-value='"+s+"'>"+p+"</a></li>":"radio"===e?o+'<input id="'+t+'" type="radio" class="'+n+' filter-value" value="'+s+'" /><label'+u+' for="'+t+'">'+p+"</label>"+d:"checkbox"===e?o+'<input id="'+t+'" type="checkbox" class="'+n+' filter-value" value="'+s+'" /><label'+u+' for="'+t+'">'+p+"</label>"+d:"group_select"===e?'<optgroup label="'+i.desc+'">'+s+"</optgroup>":"start_fakeSelect"===e?'<li class="'+n+'"'+c+'><a class="remove" href="#">'+i.desc+"</a></li>":""},enableEvents:function(){var l=this;l.on("change",".filter-group select.filter-value",function(t){t.preventDefault();var r=e(this).closest(".filter-group").data("type"),a=e(this).closest(".filter-group").attr("id"),i=e(this).val();"sort"!==a&&(l.set.latestCat=a),s.updateFilter.apply(l,[r,a,i])}),l.on("click",".filter-group a.filter-value",function(t){t.preventDefault();var r=e(this).closest(".filter-group").data("type"),a=e(this).closest(".filter-group").attr("id"),i=e(this).data("value");"sort"!==a&&(l.set.latestCat=a),e(this).hasClass("disabled")||(e(this).toggleClass(l.set.filterSelectedClass),s.updateFilter.apply(l,[r,a,i]))}),l.on("click",".remove",function(t){t.preventDefault();var r,a,i,n=e(this).closest(".filter-group");0===n.length&&(n=e(this).siblings(".filter-group")),r=n.data("type"),a=n.attr("id"),i="remove",n.find("."+l.set.filterSelectedClass).removeClass(l.set.filterSelectedClass),n.find("select").find("option").removeAttr("disabled").filter(":selected").removeAttr("selected"),s.updateFilter.apply(l,[r,a,i])}),l.on("click",".remove-all",function(e){e.preventDefault(),l.set.filteredBy={},l.set.filteredBy.page=1,l.set.currentPageLoaded=1,l.set.currentHash="",t.location.hash=l.set.currentHash,l.find(".filter-group ."+l.set.filterSelectedClass).removeClass(l.set.filterSelectedClass),l.find(".filter-group option").removeAttr("disabled").filter(":selected").removeAttr("selected"),s.gatherItems.apply(l)}),l.on("click",".next",function(e){return e.preventDefault(),l.set.filteredBy.page<l.set.pages&&(l.set.filteredBy.page+=1,l.set.currentPageLoaded+=1,l.set.currentHash=s.hashify(l.set.filteredBy),l.set.currentHash.length>0&&(t.location.hash=l.set.currentHash),l.find(".current-page").text(l.set.filteredBy.page),s.gatherItems.apply(l)),!1}),l.on("click",".prev",function(e){e.preventDefault(),l.set.filteredBy.page>1&&(l.set.filteredBy.page-=1,l.set.currentPageLoaded-=1,l.set.currentHash=s.hashify(l.set.filteredBy),l.set.currentHash.length>0&&(t.location.hash=l.set.currentHash),l.find(".current-page").text(l.set.filteredBy.page),s.gatherItems.apply(l))}),l.on("click",".all",function(t){t.preventDefault();var r=e(this).closest(".paging");r.hasClass("viewing-all")?(l.set.limit=l.set.oldLimit,r.removeClass("viewing-all"),l.find(".current-page").text(l.set.filteredBy.page)):(l.set.oldLimit=l.set.limit,l.set.limit="none",r.addClass("viewing-all"),l.find(".current-page").text(1)),s.gatherItems.apply(l)})},reSelectLatestFilter:function(){var e=this;for(var t in e.set.filteredBy)if("page"!==t&&"sort"!==t){e.set.latestCat=t;break}},updateFilter:function(l,r,a){var i=this,n=null,o=null;"s1"===l||"s"===l?void 0===i.set.filteredBy[r]||i.set.filteredBy[r].value!==a&&0!==a&&"0"!==a&&"remove"!==a?i.set.filteredBy[r]={type:l,value:a}:(delete i.set.filteredBy[r],s.reSelectLatestFilter.apply(i)):("sand"===l||"sor"===l)&&("remove"===a?void 0!==i.set.filteredBy[r]&&(delete i.set.filteredBy[r],s.reSelectLatestFilter.apply(i)):null===a?(delete i.set.filteredBy[r],s.reSelectLatestFilter.apply(i)):"object"==typeof a?a.length>0&&(i.set.filteredBy[r]={type:l,value:a}):(n=void 0!==i.set.filteredBy[r]&&void 0!==i.set.filteredBy[r].value?i.set.filteredBy[r].value:[],o=e.inArray(a,n),-1!==o||0===a||"0"===a?n.splice(o,1):n.push(a),n.length>0?i.set.filteredBy[r]={type:l,value:n}:(delete i.set.filteredBy[r],s.reSelectLatestFilter.apply(i)))),i.set.debug===!0&&console.log("var $this.set.filteredBy",i.set.filteredBy),i.set.filteredBy.page=1,i.set.currentPageLoaded=1,i.set.currentHash=s.hashify(i.set.filteredBy),t.location.hash=i.set.currentHash,s.gatherItems.apply(i),void 0!==i.set.onFilterChanged&&i.set.onFilterChanged(),i.set.updateWHash!==!1&&e("."+i.set.updateWHash).each(function(){var t=e(this).attr("href");e(this).attr("href",t+"#"+i.set.currentHash)})},reSelect:function(){var e=this,t=e.set.filteredBy,s={},l={},r="",a="";for(var i in t)if(s=e.find("#"+i),r=t[i].value,a=s.data("create"),0!==s.length)if("sort"===i&&(r=t[i].value.join("-")),"object"==typeof t[i].value&&"sort"!==i)for(var n=0;n<t[i].value.length;n++)"select"===a||"multiSelect"===a?s.find("#"+i+"-"+t[i].value[n]).attr("selected",!0):s.find("#"+i+"-"+t[i].value[n]).addClass(e.set.filterSelectedClass);else l=s.find("#"+i+"-"+r),"select"===a||"multiSelect"===a?l.attr("selected",!0):"fakeSelect"===a?(l.addClass("selected"),s.find(".fake-select").addClass("selected").find("span").text(l.text())):l.addClass(e.set.filterSelectedClass);void 0!==e.set.onFilterChanged&&e.set.onFilterChanged()},gatherItems:function(){var e=this,t=e.set.filteredBy,l=e.filter.desc.param_types,r=e.filter.total_items,a=0,i=0,n=[],o=[],d=[];for(var c in t)if("page"!==c&&"sort"!==c){if("s1"===t[c].type)o=e.filter.total_items[c][t[c].value];else if("sor"===t[c].type){for(i=0;i<t[c].value.length;i++)n[i]=e.filter.total_items[c][t[c].value[i]];o=Array.prototype.concat.apply([],n)}else if("sand"===t[c].type)for(i=0;i<t[c].value.length;i++)n[i]=e.filter.total_items[c][t[c].value[i]],o=o;d=0===a?o:s.intersect(d,o),n=[],a++}if(0===a)e.set.currentItems=e.filter.items.slice(0),e.find(".filter-group").find(".disabled,."+e.set.filterSelectedClass).removeClass("disabled "+e.set.filterSelectedClass),e.find(".filter-group option").removeAttr("disabled").filter(":selected").removeAttr("selected");else{for(i=0;i<l.length;i++)if(e.set.latestCat!==l[i]){var f=0,u={},p="";n=[];for(var g in r[l[i]])u=e.find("#"+l[i]+"-"+g),0!==u.length&&(p=u.prop("tagName").toLowerCase(),n=s.intersect(d,r[l[i]][g]),n.length>0?("option"===p||"input"===p?u.removeAttr("disabled"):u.removeClass("disabled").attr("title",n.length),f+=n.length):"option"===p||"input"===p?u.attr("disabled",!0):u.addClass("disabled").removeAttr("title"));f>0?e.find("#"+l[i]).removeClass("disabled").attr("title",f):e.find("#"+l[i]).addClass("disabled").removeAttr("title")}d=s.unique(d),e.set.currentItems=s.keysToItems.apply(e,[d])}void 0!==e.set.filteredBy.sort&&e.set.currentItems.length>0?s.sortItems.apply(e):s.renderItems.apply(e)},sortItems:function(){var e=this,t=e.set.currentItems,l=t.length,r=e.set.filteredBy.sort.value[0],a=0,i=[];for(a=0;l>a;a++)i[a]={obj:t[a]},i[a][r]="price"===r?parseInt(t[a].price.replace(/^\D+|&#160;|\D+$/g,"")):"news"===r?void 0!==t[a].newsmarker?0:10:t[a][r];for(i.sort("number"==typeof i[0][r]?function(e,t){return e[r]-t[r]}:function(e,t){return e[r]<t[r]||""===t[r]?-1:e[r]>t[r]?1:0}),"dsc"===e.set.filteredBy.sort.value[1]&&i.reverse(),e.set.currentItems=[],a=0;l>a;a++)e.set.currentItems[a]=i[a].obj;s.renderItems.apply(e)},renderItems:function(){var e=this,t=e.set.currentItems,l=t.length,r=null,a=0,i="";"none"!==e.set.limit?l>e.set.limit?(e.set.pages=Math.ceil(l/e.set.limit),e.find(".paging").removeClass("disabled"),r=e.set.limit*e.set.filteredBy.page,a=1===e.set.currentPageLoaded?e.set.currentPageLoaded*e.set.limit:(e.set.filteredBy.page-1)*e.set.limit,e.set.currentPageLoaded=e.set.filteredBy.page,l=r>t.length?a+t.length%e.set.limit:r,e.set.filteredBy.page>1?e.find(".prev").closest(".paging").removeClass("disabled"):e.find(".prev").closest(".paging").addClass("disabled"),l!==r&&e.find(".paging").addClass("disabled")):(e.set.pages=1,e.find(".paging").addClass("disabled"),e.find(".prev").closest(".paging").addClass("disabled")):e.set.pages=1,e.find(".page-total").text(e.set.pages),e.set.filteredItems&&e.set.filteredItems(t);for(var n=a;l>n;n++)e.set.eachItemAttrs&&(t[n]=e.set.eachItemAttrs(e,t[n],n)),i+=s.renderItemTemplate.apply(e,[t[n]]);e.set.appendItems&&1!==e.set.pages&&1!==e.set.filteredBy.page?e.find("#"+e.set.itemContId).append(i):e.find("#"+e.set.itemContId).html(i),void 0!==e.set.afterItemsRendered&&e.set.afterItemsRendered()},renderItemTemplate:function(e){{var t=this,s=t.filter.templates.item,l=[],r=!1,a=void 0!==e.variations?e.variations:!1,i=[],n="";l.length}if(t.set.debug===!0&&"object"!=typeof l&&console.warn("You should be using the latest version of the JSFilter class. Incl in v2"),a!==!1){for(var o=0;o<a.length;o++)i[o]=a[o].id;l=e.image[i[0]]?e.image[i[0]]:e.image[0]?e.image[0]:e.image[-1]}else if(l=e.image[0],"object"==typeof e.image&&void 0===l)for(var d in e.image)l=e.image[d];return e.hash=-1===t.set.currentHash.indexOf("#")?"#"+t.set.currentHash:t.set.currentHash,e.category_uri=null===e.category_uri?"":-1!==e.category_uri.indexOf(":")?e.category_uri.slice(0,e.category_uri.indexOf(":")):e.category_uri,n=null===e.root_uri||""===e.root_uri?"":-1!==e.root_uri.indexOf(":")?ROOT+e.root_uri.slice(0,e.root_uri.indexOf(":")):ROOT+e.root_uri,-1!==s.indexOf("{rep_")&&(s=s.replace(/<[^<]*(\{rep_(.+?)\})[^>]*>/g,function(t,s,l){for(var r="",a="</"+t.match(/<([a-z]+)/)[1]+">",n=0;n<i.length;n++)void 0!==e[l]&&void 0!==e[l][i[n]]&&(r+=t.replace(s,e[l][i[n]])+a);return r})),s=s.replace(/\{(.+?)\}/g,function(t,s){var a="";if("root_uri"===s)a=n;else if("image_"===s.substring(0,6)){var i=parseInt(s.substring(6))-1;if(a=l[i],void 0===a)return r=!0,"{#}"}else a=void 0!==e[s]?e[s]:"";return a}),r&&(s=s.replace(/<[^<]*\{#\}[^>]*>/g,"")),s},keysToItems:function(e){for(var t=this,s=[],l="",r=0;r<e.length;r++)l=t.filter.items_keys[e[r]],s[r]=t.filter.items[l];return s},unique:function(e){var t=[];e:for(var s=0;s<e.length;s++){for(var l=0;l<t.length;l++)if(t[l]==e[s])continue e;t[t.length]=e[s]}return t},intersect:function(e,t){var s=[],l={},r=0;for(r=0;r<e.length;r++)l[e[r]]=!0;for(r=0;r<t.length;r++)l[t[r]]&&(s[s.length]=t[r]);return s},dehashify:function(e){var t=this,s={},l=e.substring(1).split("&"),r=[],a="",i=!0,n=null;if(e.length>1)for(var o=0;o<l.length;o++)if(r=l[o].split("="),"page"===r[0])s.page=parseInt(r[1]);else{switch(a=r[0].split("~"),a[1]){case"sand":n=r[1].split("+");break;case"sor":case"r":case"s":case"f":n=r[1].split(",");break;default:n=r[1]}i&&"sort"!==a[0]&&(i=!1,t.set.latestCat=a[0]),s[a[0]]={type:a[1],value:n}}return void 0===s.page&&(s.page=1),s},hashify:function(e){var t="",s=null;for(var l in e)if("page"===l)e[l]>1&&(t+=l+"="+e[l]+"&");else{switch(e[l].type){case"sand":s=e[l].value.join("+");break;case"sor":case"s":case"r":case"f":s=e[l].value.join(",");break;default:s=e[l].value}t+=l+"~"+e[l].type+"="+s+"&"}return t.substring(0,t.length-1)},urlify:function(e){return e.toLowerCase().replace(/\s{2,}|\s/g,"-")}},l={init:function(l){var i=e.extend({},r,l);return t.requestAnimFrame=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)}}(),this.each(function(){var t=e(this),l=t.data();t.set=e.extend({},i,l,a),t.set.debug===!0&&(console.warn(":::: YS Filter Debug has been set to true ::::"),console.log("Options -> ",t.set),void 0===t.set.url&&console.warn("No url has been defined i.e. loadproducts/category?search=")),s.init.apply(t),t.data(t.set)})}},r={limit:20,splitSizes:!1,appendItems:!1,multipleImgs:!1,filterOptions:{},updateWHash:!1,itemContId:"item-cont",filterSelectedClass:"selected",groupClass:"filter-group"},a={filteredBy:{},currentHash:"",latestCat:"",currentItems:[],oldLimit:null,currentPageLoaded:1,pages:1};e.fn.ysFilter=function(t){return l[t]?l[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.ysFilter"):l.init.apply(this,arguments)}}(jQuery,window);