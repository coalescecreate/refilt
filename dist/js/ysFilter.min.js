/**
 * ys-filter - For filtering and sorting products returned from Silk API.
 * @version v0.2.12
 * @link http://youngskilled.com
 * @author richard@youngskilled.com Young/Skilled
 * @license MIT
 */
!function(e,t){var s={init:function(){var l=this;l.set.filteredBy=s.dehashify.apply(l,[t.location.hash]),l.set.debug===!0&&console.log("var ",l.set.filteredBy),l.set.currentHash=t.location.hash,l.addClass("ysFilter-loading ysFilter-init"),""!==l.set.currentHash&&(l.addClass("ysFilter-filtered"),l.set.updateWHash!==!1&&e("."+l.set.updateWHash).each(function(){var t=e(this).attr("href");e(this).attr("href",t+l.set.currentHash)})),parseInt(l.set.filteredBy.page,10)>1&&l.find(".prev").closest(".paging").show(),e.ajax({url:l.set.url,type:"GET",cache:!0,dataType:"JSON",success:function(e){l.filter=e,l.set.debug===!0&&console.log("var $this.filter",l.filter),s.buildFilter.apply(l),s.enableEvents.apply(l),l.set.limit=e.limit,l.set.pages=Math.ceil(e.items.length/l.set.limit),""!==l.set.currentHash?(l.set.filteredBy.page>1&&(l.find("."+l.set.paging.prevBtnClass).removeClass("."+l.set.disabledClass),l.set.initialLoad=!0),s.gatherItems.apply(l),s.reSelect.apply(l)):(l.set.currentItems=l.filter.items.slice(0),l.set.debug===!0&&s.renderItems.apply(l))}})},buildFilter:function(){var t=this,l=t.find("."+t.set.groupClass),a="",i="",r={},n=t.filter.desc.param_types.length,o=t.set.splitSizes!==!1?"</"+t.set.splitSizes.match(/<([a-z]+)/)[1]+">":"",d=t.set.splitSizes!==!1?t.set.splitSizes:"";if(void 0!==t.filter.sort){var c=e("#sort"),p=void 0!==t.filter.sort.init?t.filter.sort.init:"";i=c.data("create"),r=t.set.filterOptions[g]||{};for(var f in t.filter.sort)"init"!==f&&(t.filter.sort[f].asc&&(a+=s.buildFilterTemplate.call(t,i,"sort-"+f+"-asc",'["'+f+'","asc"]',t.filter.sort[f].asc,r)),t.filter.sort[f].dsc&&(a+=s.buildFilterTemplate.call(t,i,"sort-"+f+"-dsc",'["'+f+'","dsc"]',t.filter.sort[f].dsc,r)));void 0!==r.wrapperGroup&&(a=r.wrapperGroup+a+"</"+r.wrapperGroup.match(/<([a-z]+)/)[1]+">"),"fakeSelect"===i&&(a=s.buildFilterTemplate.call(t,"start_"+i,"","",p,r)+a,a='<div class="filter-value fake-select"><span data-orig-text="'+p+'">'+p+'</span><ul class="ul-clean fake-select-list">'+a+"</ul></div>"),("select"===i||"multiSelect"===i)&&(a='<select class="filter-value"'+("multiSelect"===i?' multiple="multiple"':"")+'><option value="0">'+p+"</option>"+a+"</select>"),c.append(a)}for(var u=0;n>u;u++){var g=t.filter.desc.param_types[u],h=t.filter.desc.param_descs[g],v=l.filter("#"+g),m=(v.data("type"),""),y="",C=null,b=null,B=[],F="",I="";a="",i=v.data("create"),r=t.set.filterOptions[g]||{};for(var _ in t.filter.desc[g])y=t.filter.desc[g][_].name,I=void 0!==t.filter.desc[g][_].chart?t.filter.desc[g][_].chart:"",t.filter.desc[g][_].data&&(""!==t.filter.desc[g][_].data.color?y=[y,t.filter.desc[g][_].data.color]:""!==t.filter.desc[g][_].data.hex&&(y=[y,t.filter.desc[g][_].data.hex])),-1!==y.indexOf("###")?(C="tree",B=y.split("###"),y=B.pop(),b!==B.join("")&&(null!==b&&(a+=s.buildFilterTemplate.call(t,"group_"+i,"",m,b,r),m=""),b=B.join("")),m+=s.buildFilterTemplate.call(t,i,g+"-"+_,_,y,r)):t.set.splitSizes!==!1&&"size"===g?(C="size",sizeTables=_.split("_"),b!==sizeTables[0]&&(null!==b&&(""!==I&&(d=t.set.splitSizes.replace("{chart}",F)),a+=d+m+o,m=""),F=I,b=sizeTables[0]),m+=s.buildFilterTemplate.call(t,i,g+"-"+_,_,y,r)):a+=s.buildFilterTemplate.call(t,i,g+"-"+_,_,y,r);null!==b&&("tree"===C?a+=s.buildFilterTemplate.call(t,"group_"+i,"",m,b,r):(""!==I&&(d=t.set.splitSizes.replace("{chart}",F)),a+=d+m+o)),void 0!==r.wrapperGroup&&(a=r.wrapperGroup+a+"</"+r.wrapperGroup.match(/<([a-z]+)/)[1]+">"),"fakeSelect"===i&&(m=s.buildFilterTemplate.call(t,"start_"+i,"",_,h,r),a='<div class="filter-value fake-select"><span data-orig-text="'+h+'">'+h+'</span><ul class="ul-clean fake-select-list">'+m+a+"</ul></div>"),("select"===i||"multiSelect"===i)&&(a='<select name="'+g+'" class="filter-value"'+("multiSelect"===i?' multiple="multiple"':"")+'><option value="0">'+h+"</option>"+a+"</select>"),v.append(a)}t.removeClass("ysFilter-loading ysFilter-filtered").addClass("ysFilter-loaded"),void 0!==t.set.afterFilterRendered&&t.set.afterFilterRendered()},buildFilterTemplate:function(e,t,s,l,a){var i=this,r={desc:l},n="",o="",d="",c="",p="",f="",u="",g=!1;for(var h in a)switch(h){case"classNames":n=a[h].join(" ");break;case"background":g=a[h];break;case"attrs":c=" "+a[h].replace("{desc}",l[0]);break;case"wrapper":o=a[h],d="</"+a[h].match(/<([a-z]+)/)[1]+">"}return"object"==typeof l&&(r.desc=l[0],g&&(p=l[1]&&"#"===l[1].substr(0,1)?"background-color: "+l[1]:"background-image: url('"+DYN+"attributes/"+l[1]+"')")),void 0!==i.set.eachFilterAttrs&&(r=i.set.eachFilterAttrs(r)),f=g?' style="'+p+'"':"",u=g?"":r.desc,"a"===e?o+'<a id="'+t+'" class="'+n+' filter-value" href="#"'+f+" data-value='"+s+"'"+c+">"+u+"</a>"+d:"select"===e||"multiSelect"===e?'<option id="'+t+'" value="'+s+'">'+r.desc+"</option>":"fakeSelect"===e?'<li class="'+n+'"'+c+'><a id="'+t+'" class="filter-value" href="#"'+f+" data-value='"+s+"'>"+u+"</a></li>":"radio"===e?o+'<input id="'+t+'" type="radio" class="'+n+' filter-value" value="'+s+'" /><label'+f+' for="'+t+'">'+u+"</label>"+d:"checkbox"===e?o+'<input id="'+t+'" type="checkbox" class="'+n+' filter-value" value="'+s+'" /><label'+f+' for="'+t+'">'+u+"</label>"+d:"group_select"===e?'<optgroup label="'+r.desc+'">'+s+"</optgroup>":"start_fakeSelect"===e?'<li class="'+n+'"'+c+'><a class="remove" href="#">'+r.desc+"</a></li>":""},enableEvents:function(){var l=this;l.on("change",".filter-group select.filter-value",function(t){t.preventDefault();var a=e(this).closest(".filter-group").data("type"),i=e(this).closest(".filter-group").attr("id"),r=e(this).val();"sort"!==i&&(l.set.latestCat=i),s.updateFilter.apply(l,[a,i,r])}),l.on("click",".filter-group a.filter-value",function(t){t.preventDefault();var a=e(this).closest(".filter-group").data("type"),i=e(this).closest(".filter-group").attr("id"),r=e(this).data("value");"sort"!==i&&(l.set.latestCat=i),e(this).hasClass("disabled")||(e(this).toggleClass(l.set.filterSelectedClass),s.updateFilter.apply(l,[a,i,r]))}),l.on("click",".filter-group input[type=checkbox].filter-value",function(){var t=e(this).closest(".filter-group").data("type"),a=e(this).closest(".filter-group").attr("id"),i=e(this).val();"sort"!==a&&(l.set.latestCat=a),e(this).hasClass("disabled")||(e(this).toggleClass(l.set.filterSelectedClass),s.updateFilter.apply(l,[t,a,i]))}),l.on("click",".remove",function(t){t.preventDefault();var a,i,r,n=e(this).closest(".filter-group");0===n.length&&(n=e(this).siblings(".filter-group")),a=n.data("type"),i=n.attr("id"),r="remove",n.find("."+l.set.filterSelectedClass).removeClass(l.set.filterSelectedClass),n.find("select").find("option").removeAttr("disabled").filter(":selected").removeAttr("selected"),s.updateFilter.apply(l,[a,i,r])}),l.on("click",".remove-all",function(a){a.preventDefault();var i=e(t).scrollTop();l.set.filteredBy={},l.set.filteredBy.page=1,l.set.currentHash="",t.location.hash=l.set.currentHash,e(t).scrollTop(i),l.find(".filter-group ."+l.set.filterSelectedClass).removeClass(l.set.filterSelectedClass),l.find(".filter-group option").removeAttr("disabled").filter(":selected").removeAttr("selected"),s.gatherItems.apply(l)}),l.on("click","."+l.set.paging.nextBtnClass,function(e){return e.preventDefault(),l.set.filteredBy.page<l.set.pages&&(l.set.filteredBy.page+=1,l.set.currentHash=s.hashify(l.set.filteredBy),l.set.currentHash.length>0&&(t.location.hash=l.set.currentHash),l.find("."+l.set.pageCurrentClass).text(l.set.filteredBy.page),s.gatherItems.apply(l)),!1}),l.on("click","."+l.set.paging.prevBtnClass,function(a){a.preventDefault();var i=e(t).scrollTop();l.set.filteredBy.page>1&&(l.set.filteredBy.page-=1,l.set.currentHash=s.hashify(l.set.filteredBy),t.location.hash=l.set.currentHash,e(t).scrollTop(i),l.find("."+l.set.pageCurrentClass).text(l.set.filteredBy.page),s.gatherItems.apply(l))}),l.on("click","."+l.set.paging.allBtnClass,function(t){t.preventDefault();var a=e(this).closest("."+l.set.paging.contClass);a.hasClass("viewing-all")?(l.set.limit=l.set.oldLimit,a.removeClass("viewing-all"),l.find("."+l.set.pageCurrentClass).text(l.set.filteredBy.page)):(l.set.oldLimit=l.set.limit,l.set.limit="none",a.addClass("viewing-all"),l.find("."+l.set.pageCurrentClass).text(1)),s.gatherItems.apply(l)})},reSelectLatestFilter:function(){var e=this;for(var t in e.set.filteredBy)if("page"!==t&&"sort"!==t){e.set.latestCat=t;break}},updateFilter:function(l,a,i){var r=this,n=null,o=null;"s1"===l||"s"===l?void 0===r.set.filteredBy[a]||r.set.filteredBy[a].value!==i&&0!==i&&"0"!==i&&"remove"!==i?r.set.filteredBy[a]={type:l,value:i}:(delete r.set.filteredBy[a],s.reSelectLatestFilter.apply(r)):("sand"===l||"sor"===l)&&("remove"===i?void 0!==r.set.filteredBy[a]&&(delete r.set.filteredBy[a],s.reSelectLatestFilter.apply(r)):null===i?(delete r.set.filteredBy[a],s.reSelectLatestFilter.apply(r)):"object"==typeof i?i.length>0&&(r.set.filteredBy[a]={type:l,value:i}):(n=void 0!==r.set.filteredBy[a]&&void 0!==r.set.filteredBy[a].value?r.set.filteredBy[a].value:[],o=e.inArray(i,n),-1!==o||0===i||"0"===i?n.splice(o,1):n.push(i),n.length>0?r.set.filteredBy[a]={type:l,value:n}:(delete r.set.filteredBy[a],s.reSelectLatestFilter.apply(r)))),r.set.debug===!0&&console.log("var $this.set.filteredBy",r.set.filteredBy),r.set.filteredBy.page=1,r.set.currentHash=s.hashify(r.set.filteredBy),t.location.hash=r.set.currentHash,s.gatherItems.apply(r),void 0!==r.set.onFilterChanged&&r.set.onFilterChanged(),r.set.updateWHash!==!1&&e("."+r.set.updateWHash).each(function(){var t=e(this).attr("href");e(this).attr("href",t+"#"+r.set.currentHash)})},reSelect:function(){var e=this,t=e.set.filteredBy,s={},l={},a="",i="";for(var r in t)if(s=e.find("#"+r),a=t[r].value,i=s.data("create"),0!==s.length)if("sort"===r&&(a=t[r].value.join("-")),"object"==typeof t[r].value&&"sort"!==r)for(var n=0;n<t[r].value.length;n++)"select"===i||"multiSelect"===i?s.find("#"+r+"-"+t[r].value[n]).attr("selected",!0):s.find("#"+r+"-"+t[r].value[n]).addClass(e.set.filterSelectedClass);else l=s.find("#"+r+"-"+a),"select"===i||"multiSelect"===i?l.attr("selected",!0):"fakeSelect"===i?(l.addClass("selected"),s.find(".fake-select").addClass("selected").find("span").text(l.text())):l.addClass(e.set.filterSelectedClass);void 0!==e.set.onFilterChanged&&e.set.onFilterChanged()},gatherItems:function(){var e=this,t=e.set.filteredBy,l=e.filter.desc.param_types,a=e.filter.total_items,i=0,r=0,n=[],o=[],d=[];for(var c in t)if("page"!==c&&"sort"!==c){if("s1"===t[c].type)o=e.filter.total_items[c][t[c].value];else if("sor"===t[c].type){for(r=0;r<t[c].value.length;r++)n[r]=e.filter.total_items[c][t[c].value[r]];o=Array.prototype.concat.apply([],n)}else if("sand"===t[c].type)for(r=0;r<t[c].value.length;r++)n[r]=e.filter.total_items[c][t[c].value[r]],o=o;d=0===i?o:s.intersect(d,o),n=[],i++}if(0===i)e.set.currentItems=e.filter.items.slice(0),e.find(".filter-group").find(".disabled,."+e.set.filterSelectedClass).removeClass("disabled "+e.set.filterSelectedClass),e.find(".filter-group option").removeAttr("disabled").filter(":selected").removeAttr("selected");else{for(r=0;r<l.length;r++)if(e.set.latestCat!==l[r]){var p=0,f={},u="";n=[];for(var g in a[l[r]])f=e.find("#"+l[r]+"-"+g),0!==f.length&&(u=f.prop("tagName").toLowerCase(),n=s.intersect(d,a[l[r]][g]),n.length>0?("option"===u||"input"===u?f.removeAttr("disabled"):f.removeClass("disabled").attr("title",n.length),p+=n.length):"option"===u||"input"===u?f.attr("disabled",!0):f.addClass("disabled").removeAttr("title"));p>0?e.find("#"+l[r]).removeClass("disabled").attr("title",p):e.find("#"+l[r]).addClass("disabled").removeAttr("title")}d=s.unique(d),e.set.currentItems=s.keysToItems.apply(e,[d])}void 0!==e.set.filteredBy.sort&&e.set.currentItems.length>0?s.sortItems.apply(e):s.renderItems.apply(e)},sortItems:function(){var e=this,t=e.set.currentItems,l=t.length,a=e.set.filteredBy.sort.value[0],i=0,r="",n=[];for(i=0;l>i;i++)n[i]={obj:t[i]},"price"===a?(r=t[i].price,-1!==r.indexOf("sale")&&(r=r.substring(r.indexOf("sale"))),-1!==r.indexOf("newprice")&&(r=r.substring(r.indexOf("newprice"))),r=parseInt(r.replace(/^\D+|&#160;|\D+$/g,""),10),isNaN(r)&&(r=99999999),n[i][a]=r):n[i][a]="news"===a?void 0!==t[i].newsmarker?0:10:t[i][a];for(n.sort("number"==typeof n[0][a]?function(e,t){return e[a]-t[a]}:function(e,t){return e[a]<t[a]||""===t[a]?-1:e[a]>t[a]?1:0}),"dsc"===e.set.filteredBy.sort.value[1]&&n.reverse(),e.set.currentItems=[],i=0;l>i;i++)e.set.currentItems[i]=n[i].obj;s.renderItems.apply(e)},renderItems:function(){var t=this,l=t.set.currentItems,a=l.length,i=null,r=0,n="",o="";t.set.initialLoad?(r=t.set.appendItems?0:t.set.limit*(t.set.filteredBy.page-1),i=t.set.limit*t.set.filteredBy.page,a=i>a?a:i,t.set.filteredBy.page>1&&t.find("."+t.set.paging.prevBtnClass).removeClass(t.set.disabledClass),a!==i&&t.find("."+t.set.paging.nextBtnClass).addClass(t.set.disabledClass)):"none"!==t.set.limit?a>t.set.limit?(t.set.pages=Math.ceil(a/t.set.limit),i=t.set.limit*t.set.filteredBy.page,r=(t.set.filteredBy.page-1)*t.set.limit,a=i>a?a:i,t.set.filteredBy.page>1?t.find("."+t.set.paging.prevBtnClass).removeClass(t.set.disabledClass):t.find("."+t.set.paging.prevBtnClass).addClass(t.set.disabledClass),a!==i?t.find("."+t.set.paging.nextBtnClass).addClass(t.set.disabledClass):t.find("."+t.set.paging.nextBtnClass).removeClass(t.set.disabledClass),t.find("."+t.set.paging.contClass).removeClass(t.set.disabledClass)):(t.set.pages=1,t.find("."+t.set.paging.contClass).addClass(t.set.disabledClass)):(t.set.pages=1,t.find("."+t.set.paging.nextBtnClass+",."+t.set.paging.prevBtnClass).addClass(t.set.disabledClass)),t.find("."+t.set.pageTotalClass).text(t.set.pages),t.find("."+t.set.itemTotalClass).text(l.length),t.find("."+t.set.currentTotalClass).text(a),t.set.filteredItems&&t.set.filteredItems(l);for(var d=r;a>d;d++)t.set.eachItemAttrs&&(l[d]=t.set.eachItemAttrs(t,l[d],d)),o+=s.renderItemTemplate.apply(t,[l[d]]);t.set.appendItems&&1!==t.set.pages&&1!==t.set.filteredBy.page&&t.set.initialLoad===!1?t.find("#"+t.set.itemContId).append(o):t.find("#"+t.set.itemContId).html(o),t.set.initialLoad=!1,n=-1===t.set.currentHash.indexOf("#")?"#"+t.set.currentHash:t.set.currentHash,t.find("#"+t.set.itemContId+" a").each(function(){var t=e(this).attr("href");-1!==t.indexOf("#")&&(t=t.substring(0,t.indexOf("#"))),e(this).attr("href",t+n)}),void 0!==t.set.afterItemsRendered&&t.set.afterItemsRendered()},renderItemTemplate:function(e){{var t=this,s=t.filter.templates.item,l=[],a=!1,i=void 0!==e.variations?e.variations:!1,r=[],n="";l.length}if(t.set.debug===!0&&"object"!=typeof l&&console.warn("You should be using the latest version of the JSFilter class. Incl in v2"),i!==!1){for(var o=0;o<i.length;o++)r[o]=i[o].id;l=e.image[r[0]]?e.image[r[0]]:e.image[0]?e.image[0]:e.image[-1]}else if(l=e.image[0],"object"==typeof e.image&&void 0===l)for(var d in e.image)l=e.image[d];return e.hash=-1===t.set.currentHash.indexOf("#")?"#"+t.set.currentHash:t.set.currentHash,e.category_uri=null===e.category_uri?"":-1!==e.category_uri.indexOf(":")?e.category_uri.slice(0,e.category_uri.indexOf(":")):e.category_uri,e.top_category_uri=null===e.top_category_uri?"":-1!==e.top_category_uri.indexOf(":")?"/"+e.top_category_uri.slice(0,e.top_category_uri.indexOf(":")):"/"+e.top_category_uri,n=null===e.root_uri||""===e.root_uri?"":-1!==e.root_uri.indexOf(":")?ROOT+e.root_uri.slice(0,e.root_uri.indexOf(":")):ROOT+e.root_uri,-1!==s.indexOf("{rep_")&&(s=s.replace(/<[^<]*(\{rep_(.+?)\})[^>]*>/g,function(t,s,l){for(var a="",i="</"+t.match(/<([a-z]+)/)[1]+">",n=0;n<r.length;n++)void 0!==e[l]&&void 0!==e[l][r[n]]&&(a+=t.replace(s,e[l][r[n]])+i);return a})),s=s.replace(/\{(.+?)\}/g,function(t,s){var i="";if("root_uri"===s)i=n;else if("image_"===s.substring(0,6)){var r=parseInt(s.substring(6),10)-1;if(i=l[r],void 0===i)return a=!0,"{#}"}else i=void 0!==e[s]?e[s]:"";return i}),a&&(s=s.replace(/<[^<]*\{#\}[^>]*>/g,"")),s},keysToItems:function(e){for(var t=this,s=[],l="",a=0;a<e.length;a++)l=t.filter.items_keys[e[a]],s[a]=t.filter.items[l];return s},unique:function(e){var t=[];e:for(var s=0;s<e.length;s++){for(var l=0;l<t.length;l++)if(t[l]==e[s])continue e;t[t.length]=e[s]}return t},intersect:function(e,t){var s=[],l={},a=0;for(a=0;a<e.length;a++)l[e[a]]=!0;for(a=0;a<t.length;a++)l[t[a]]&&(s[s.length]=t[a]);return s},dehashify:function(e){var t=this,s={},l=e.substring(1).split("&"),a=[],i="",r=!0,n=null;if(e.length>1)for(var o=0;o<l.length;o++)if(a=l[o].split("="),"page"===a[0])s.page=parseInt(a[1],10);else{switch(i=a[0].split("~"),i[1]){case"sand":n=a[1].split("+");break;case"sor":case"r":case"s":case"f":n=a[1].split(",");break;default:n=a[1]}r&&"sort"!==i[0]&&(r=!1,t.set.latestCat=i[0]),s[i[0]]={type:i[1],value:n}}return void 0===s.page&&(s.page=1),s},hashify:function(e){var t="",s=null;for(var l in e)if("page"===l)e[l]>1&&(t+=l+"="+e[l]+"&");else{switch(e[l].type){case"sand":s=e[l].value.join("+");break;case"sor":case"s":case"r":case"f":s=e[l].value.join(",");break;default:s=e[l].value}t+=l+"~"+e[l].type+"="+s+"&"}return t.substring(0,t.length-1)},urlify:function(e){return e.toLowerCase().replace(/\s{2,}|\s/g,"-")}},l={init:function(l){var r=e.extend({},a,l);return t.requestAnimFrame=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)}}(),this.each(function(){var t=e(this),l=t.data();t.set=e.extend({},r,l,i),t.set.debug===!0&&(console.warn(":::: YS Filter Debug has been set to true ::::"),console.log("Options -> ",t.set),void 0===t.set.url&&console.warn("No url has been defined i.e. loadproducts/category?search=")),s.init.apply(t),t.data(t.set)})}},a={limit:20,splitSizes:!1,appendItems:!1,multipleImgs:!1,filterOptions:{},paging:{contClass:"paging",nextBtnClass:"next",prevBtnClass:"prev",allBtnClass:"all"},updateWHash:!1,itemContId:"item-cont",filterSelectedClass:"selected",disabledClass:"disabled",groupClass:"filter-group",pageTotalClass:"page-total",pageCurrentClass:"current-page",itemTotalClass:"item-total",currentTotalClass:"current-total"},i={filteredBy:{},currentHash:"",latestCat:"",currentItems:[],oldLimit:null,initialLoad:!1,pages:1};e.fn.ysFilter=function(t){return l[t]?l[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.ysFilter"):l.init.apply(this,arguments)}}(jQuery,window);